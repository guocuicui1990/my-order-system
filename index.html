<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ‘Šä½ - æ‰«ç ç‚¹é¤</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- å•†å®¶é…ç½®æ–‡ä»¶ -->
    <script src="config.js"></script>
    <style>
        :root {
            --primary-color: #E63946;
            --secondary-color: #F4A261;
            --accent-color: #2A9D8F;
            --light-bg: #FFF5F5;
            --dark-text: #333333;
            --light-text: #666666;
        }
        
        .logo-container {
            text-align: center;
            margin: 60px 0 40px;
        }
        
        .logo-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .logo-container h1 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--dark-text);
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 14px;
            color: var(--light-text);
        }
        
        .sequence-card {
            background: white;
            border-radius: 15px;
            padding: 25px 20px;
            box-shadow: 0 5px 20px rgba(230, 57, 70, 0.1);
            text-align: center;
            margin-bottom: 20px;
            border: 2px solid var(--light-bg);
        }
        
        .sequence-number {
            font-size: 56px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 15px 0;
            letter-spacing: 2px;
        }
        
        .sequence-hint {
            font-size: 14px;
            color: var(--light-text);
            margin-bottom: 25px;
        }
        
        .waiting-info {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }
        
        .waiting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
        }
        
        .waiting-label {
            font-size: 14px;
            color: var(--light-text);
        }
        
        .waiting-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .smart-recommend {
            background: linear-gradient(135deg, #FFF9E6, #FFF0F0);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid var(--secondary-color);
        }
        
        .recommend-title {
            font-weight: 600;
            color: var(--dark-text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .recommend-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(230, 57, 70, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .recommend-item:last-child {
            border-bottom: none;
        }
        
        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary-color), #C62828);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
        }
        
        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .back-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark-text);
            cursor: pointer;
            padding: 5px;
        }
        
        .order-info {
            text-align: center;
        }
        
        .sequence-display {
            font-weight: 600;
            color: var(--dark-text);
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .order-status {
            font-size: 12px;
            color: var(--light-text);
        }
        
        .cart-icon {
            position: relative;
            font-size: 22px;
            color: var(--primary-color);
            cursor: pointer;
        }
        
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-color);
            color: white;
            font-size: 10px;
            min-width: 16px;
            height: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .category-tabs {
            display: flex;
            overflow-x: auto;
            padding: 10px 15px;
            background: white;
            gap: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .category-tab {
            padding: 8px 16px;
            background: #f8f9fa;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            color: var(--light-text);
        }
        
        .category-tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .dishes-container {
            padding: 15px;
            display: grid;
            gap: 15px;
        }
        
        .dish-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .dish-card:hover {
            transform: translateY(-2px);
        }
        
        .dish-emoji {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #FFE5E5, #FFF3E0);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            flex-shrink: 0;
        }
        
        .dish-details {
            flex: 1;
        }
        
        .dish-name {
            font-weight: 600;
            font-size: 15px;
            color: var(--dark-text);
            margin-bottom: 5px;
        }
        
        .dish-price {
            color: var(--primary-color);
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .dish-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .quantity-btn:active {
            transform: scale(0.95);
        }
        
        .dish-quantity {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
        }
        
        .bottom-cart-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 15px;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
            border-radius: 15px 15px 0 0;
            z-index: 1000;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .cart-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-items-count {
            font-size: 14px;
            color: var(--light-text);
        }
        
        .cart-total {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .checkout-btn {
            padding: 12px 25px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .checkout-btn:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        .checkout-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .checkout-title {
            flex: 1;
            text-align: center;
            font-weight: 600;
            color: var(--dark-text);
        }
        
        .order-confirmation {
            padding: 20px 15px;
        }
        
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .order-info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .order-info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: var(--light-text);
            font-size: 14px;
        }
        
        .info-value {
            font-weight: 600;
            color: var(--dark-text);
        }
        
        .order-items {
            margin: 15px 0;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .order-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            margin-top: 10px;
            border-top: 2px solid #f8f9fa;
            font-weight: 600;
            font-size: 18px;
        }
        
        .total-amount {
            color: var(--primary-color);
        }
        
        .payment-area {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .payment-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-text);
        }
        
        .payment-tip {
            font-size: 13px;
            color: var(--light-text);
            margin-bottom: 20px;
        }
        
        .qrcode-wrapper {
            width: 220px;
            margin: 0 auto 25px;
            position: relative;
        }
        
        .qrcode-img {
            width: 100%;
            border-radius: 8px;
            display: block;
        }
        
        .qrcode-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 0 0 8px 8px;
        }
        
        .payment-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: #f8f9fa;
            color: var(--dark-text);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-success {
            flex: 1;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .success-page {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 60px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }
        
        .success-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-text);
        }
        
        .sequence-display-large {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 20px 0;
            letter-spacing: 2px;
        }
        
        .success-message {
            font-size: 16px;
            color: var(--light-text);
            margin-bottom: 30px;
        }
        
        .status-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f8f9fa;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            color: var(--light-text);
        }
        
        .status-value {
            font-weight: 600;
        }
        
        .hidden {
            display: none !important;
        }
        
        .refresh-status-btn {
            background: #E63946;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .refresh-status-btn:hover {
            background: #C62828;
            transform: translateY(-1px);
        }
        
        .refresh-status-btn:active {
            transform: translateY(0);
        }
        
        .refresh-status-btn .fa-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-header h3 {
            margin: 0;
            font-size: 16px;
            color: var(--dark-text);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: flex;
            align-items: flex-end;
        }
        
        .modal-content {
            background: white;
            width: 100%;
            max-height: 70vh;
            border-radius: 20px 20px 0 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
        }
        
        .modal-header h3 {
            font-size: 16px;
            color: #333;
            margin: 0;
        }
        
        .btn-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #666;
            cursor: pointer;
            padding: 5px;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            max-height: 40vh;
        }
        
        .cart-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .cart-actions {
            display: flex;
            gap: 10px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 3000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f0f0f0;
            border-top-color: #E63946;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        /* è¿”å›å•†å®¶åˆ—è¡¨é“¾æ¥ */
        .back-to-shops {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
        }
        
        .back-to-shops a {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 20px;
            background: #f8f9fa;
            transition: all 0.3s;
        }
        
        .back-to-shops a:hover {
            background: #e9ecef;
            color: #333;
        }
        
        /* æ”¯ä»˜æ–¹å¼æŒ‰é’®æ ·å¼ï¼ˆæ–°å¢ï¼‰ */
        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .payment-method-btn {
            padding: 12px 20px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
        }
        
        .payment-method-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .payment-method-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .payment-method-btn .fab {
            font-size: 18px;
        }
        
        /* å¾®ä¿¡æ”¯ä»˜æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .payment-method-btn:nth-child(1).active {
            background: #07C160; /* å¾®ä¿¡ç»¿è‰² */
            border-color: #07C160;
        }
        
        /* æ”¯ä»˜å®æ”¯ä»˜æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .payment-method-btn:nth-child(2).active {
            background: #00A0E9; /* æ”¯ä»˜å®è“è‰² */
            border-color: #00A0E9;
        }
        
        /* æ–°å¢ï¼šæ”¶æ¬¾ç é”™è¯¯æç¤ºæ ·å¼ */
        .qr-error-message {
            text-align: center;
            padding: 30px 20px;
            background: #fff8f8;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed #ffcccc;
        }
        
        .qr-error-message i {
            font-size: 40px;
            color: #f44336;
            margin-bottom: 15px;
        }
        
        .qr-error-message h4 {
            color: #f44336;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .qr-error-message p {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <!-- é¡ºåºå·é¡µé¢ -->
    <div id="sequencePage" class="page">
        <div class="logo-container">
            <div class="logo-icon">
                <img src="images/logo.png" alt="æˆ‘çš„æ‘Šä½" class="logo-image">
            </div>
            <h1>æ¬¢è¿å…‰ä¸´</h1>
            <p class="subtitle">æ‰«ç ç‚¹é¤ Â· å‡­å·å–é¤</p>
        </div>
        
        <div class="sequence-card">
            <div style="font-size: 14px; color: var(--light-text);">
                æ‚¨çš„å–é¤å·æ˜¯
            </div>
            <div class="sequence-number" id="sequenceNumber">A001</div>
            <div class="sequence-hint">
                è¯·è®°ä½æ­¤å·ç ï¼Œå‡­å·å–é¤
            </div>
            
            <div class="waiting-info">
                <div class="waiting-item">
                    <span class="waiting-label">å½“å‰ç­‰å¾…</span>
                    <span class="waiting-value" id="waitingCount">çº¦2-3å•</span>
                </div>
                <div class="waiting-item">
                    <span class="waiting-label">é¢„è®¡ç­‰å¾…æ—¶é—´</span>
                    <span class="waiting-value" id="waitingTime">8-12åˆ†é’Ÿ</span>
                </div>
            </div>
            
            <button class="btn-primary" onclick="enterMenu()">
                <i class="fas fa-utensils"></i> å¼€å§‹ç‚¹é¤
            </button>
        </div>
        
        <div class="smart-recommend">
            <div class="recommend-title">
                <i class="fas fa-crown"></i> ä»Šæ—¥æ¨è
            </div>
            <div id="recommendationsList">
                <!-- åŠ¨æ€åŠ è½½æ¨èèœå“ -->
                <div class="loading-recommend" style="text-align: center; padding: 20px; color: #999;">
                    <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½æ¨èèœå“...
                </div>
            </div>
        </div>
        
        <!-- è¿”å›å•†å®¶åˆ—è¡¨é“¾æ¥ -->
        <div class="back-to-shops">
            <a href="shops.html">
                <i class="fas fa-arrow-left"></i> è¿”å›å•†å®¶åˆ—è¡¨
            </a>
        </div>
    </div>

    <!-- èœå•é¡µé¢ -->
    <div id="menuPage" class="page hidden">
        <div class="menu-header">
            <button class="back-btn" onclick="backToSequence()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="order-info">
                <div class="sequence-display" id="currentSequence">A001</div>
                <div class="order-status" id="cartStatus">æœªé€‰æ‹©èœå“</div>
            </div>
            <div class="cart-icon" onclick="showCartModal()">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-badge" id="cartBadge">0</span>
            </div>
        </div>

        <!-- èœå“åˆ†ç±» -->
        <div class="category-tabs" id="categoryTabs">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- èœå“åˆ—è¡¨ -->
        <div class="dishes-container" id="dishesContainer">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- åº•éƒ¨è´­ç‰©è½¦æ  -->
        <div class="bottom-cart-bar">
            <div class="cart-summary">
                <div>
                    <div class="cart-items-count" id="cartItemsCount">0ä¸ªèœå“</div>
                    <div class="cart-total">æ€»è®¡: Â¥<span id="cartTotal">0</span></div>
                </div>
                <button class="checkout-btn" onclick="goToCheckout()" disabled id="checkoutBtn">
                    å»ç»“ç®—
                </button>
            </div>
        </div>
    </div>

    <!-- è´­ç‰©è½¦å¼¹çª— -->
    <div id="cartModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è´­ç‰©è½¦</h3>
                <button class="btn-close" onclick="hideCartModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-items" id="cartItems">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>åˆè®¡</span>
                    <span>Â¥<span id="modalCartTotal">0</span></span>
                </div>
                <div class="cart-actions">
                    <button class="btn-secondary" onclick="clearCart()">
                        æ¸…ç©º
                    </button>
                    <button class="btn-primary" onclick="goToCheckout()" id="modalCheckoutBtn" disabled>
                        å»ç»“ç®—
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»“è´¦é¡µé¢ -->
    <div id="checkoutPage" class="page hidden">
        <div class="checkout-header">
            <button class="back-btn" onclick="backToMenu()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="checkout-title">è®¢å•ç¡®è®¤</div>
        </div>
        
        <div class="order-confirmation">
            <div class="order-card">
                <div class="order-info-row">
                    <span class="info-label">å–é¤å·</span>
                    <span class="info-value" id="checkoutSequence">A001</span>
                </div>
                <div class="order-info-row">
                    <span class="info-label">è®¢å•å·</span>
                    <span class="info-value" id="orderNumber">-</span>
                </div>
                <div class="order-info-row">
                    <span class="info-label">ä¸‹å•æ—¶é—´</span>
                    <span class="info-value" id="orderTime">-</span>
                </div>
                
                <div class="order-items" id="checkoutItems">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="order-total">
                    <span>åº”ä»˜é‡‘é¢</span>
                    <span class="total-amount">Â¥<span id="finalAmount">0</span></span>
                </div>
            </div>
            
            <div class="payment-area">
                <div class="payment-title">æ‰«ç æ”¯ä»˜</div>
                <div class="payment-tip">è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼å¹¶æ‰«æä¸‹æ–¹äºŒç»´ç </div>
                
                <!-- æ”¶æ¬¾ç é”™è¯¯æç¤ºï¼ˆæ–°å¢ï¼‰ -->
                <div id="qrErrorContainer" style="display: none;">
                    <!-- åŠ¨æ€ç”Ÿæˆé”™è¯¯ä¿¡æ¯ -->
                </div>
                
                <!-- æ”¯ä»˜æ–¹å¼é€‰æ‹©ï¼ˆæ–°å¢ï¼‰ -->
                <div class="payment-methods" id="paymentMethods" style="display: none; flex; gap: 10px; margin-bottom: 20px; justify-content: center;">
                    <button class="payment-method-btn active" id="paymentMethodWechat" onclick="switchPaymentMethod('wechat')">
                        <i class="fab fa-weixin"></i> å¾®ä¿¡æ”¯ä»˜
                    </button>
                    <button class="payment-method-btn" id="paymentMethodAlipay" onclick="switchPaymentMethod('alipay')">
                        <i class="fab fa-alipay"></i> æ”¯ä»˜å®æ”¯ä»˜
                    </button>
                </div>
                
                <div class="qrcode-wrapper" id="qrcodeWrapper">
                    <img id="qrcodeImg" src="" alt="æ”¶æ¬¾ç " class="qrcode-img" style="display: none;">
                    <div class="qrcode-overlay" style="display: none;">
                        è¯·æ”¯ä»˜ Â¥<span id="qrcodeAmount">0</span>
                    </div>
                </div>
                
                <div class="payment-buttons">
                    <button class="btn-secondary" onclick="backToMenu()">
                        ä¿®æ”¹è®¢å•
                    </button>
                    <button class="btn-success" onclick="submitOrder()" id="submitOrderBtn" disabled>
                        æäº¤è®¢å•
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸé¡µé¢ -->
    <div id="successPage" class="page hidden">
        <div class="success-page">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="success-title">è®¢å•æäº¤æˆåŠŸï¼</h2>
            <div class="sequence-display-large" id="successSequence">A001</div>
            <p class="success-message">è¯·å‡­æ­¤å·ç åˆ°æ‘Šä½å–é¤</p>
            
            <div class="status-card">
                <div class="status-header">
                    <h3><i class="fas fa-info-circle"></i> è®¢å•çŠ¶æ€</h3>
                    <button class="refresh-status-btn" onclick="refreshOrderStatus()" id="refreshBtn">
                        <i class="fas fa-sync-alt" id="refreshIcon"></i> åˆ·æ–°çŠ¶æ€
                    </button>
                </div>
                <div class="status-item">
                    <span class="status-label">è®¢å•çŠ¶æ€</span>
                    <span class="status-value" id="orderStatus">ç­‰å¾…æ¥å•</span>
                </div>
                <div class="status-item">
                    <span class="status-label">å‰æ–¹ç­‰å¾…</span>
                    <span class="status-value" id="queueAhead">2å•</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é¢„è®¡å–é¤æ—¶é—´</span>
                    <span class="status-value" id="pickupTime">18:45</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æœ€åæ›´æ–°</span>
                    <span class="status-value" id="lastStatusUpdate">åˆšåˆš</span>
                </div>
            </div>
            
            <button class="btn-primary" onclick="newOrder()" style="margin-top: 20px;">
                <i class="fas fa-plus"></i> å†æ¥ä¸€å•
            </button>
        </div>
    </div>

    <!-- åŠ è½½åŠ¨ç”» -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p>æ­£åœ¨æäº¤è®¢å•...</p>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
    // ============================================
    // å…¨å±€å˜é‡å’Œé…ç½®
    // ============================================
    window._cart = [];
    window._dishesData = []; // å°†åœ¨åˆå§‹åŒ–æ—¶ä»å•†å®¶é…ç½®åŠ è½½
    window.currentShopId = ''; // å½“å‰å•†å®¶ID
    window.currentShopConfig = null; // å½“å‰å•†å®¶é…ç½®
    window.shopPaymentQR = null; // å•†å®¶æ”¶æ¬¾ç é…ç½®
    window.currentPaymentMethod = 'wechat'; // å½“å‰æ”¯ä»˜æ–¹å¼

// ============================================
// ä»SupabaseåŠ¨æ€åŠ è½½å•†å®¶èœå“
// ============================================
async function loadShopDishesFromSupabase(shopId) {
    try {
        console.log('ğŸ“‹ ä»SupabaseåŠ è½½å•†å®¶èœå“ï¼Œå•†å®¶ID:', shopId);
        
        // æ£€æŸ¥Supabaseæ˜¯å¦å·²è¿æ¥
        if (!window.supabaseClient || !window.isCloudConnected) {
            console.log('ğŸ“ Supabaseæœªè¿æ¥ï¼Œä½¿ç”¨é»˜è®¤èœå“');
            return null;
        }
        
        // ä»SupabaseåŠ è½½å•†å®¶çš„èœå“
        const { data: dishes, error } = await window.supabaseClient
            .from('dishes')
            .select('*')
            .eq('tenant_id', shopId)
            .eq('is_active', true)
            .order('sort_order', { ascending: true });
        
        if (error) {
            console.error('âŒ ä»SupabaseåŠ è½½èœå“å¤±è´¥:', error);
            return null;
        }
        
        if (dishes && dishes.length > 0) {
            console.log('âœ… ä»SupabaseåŠ è½½åˆ°èœå“:', dishes.length, 'ä¸ª');
            
            // è½¬æ¢æ•°æ®æ ¼å¼
            const formattedDishes = dishes.map(dish => ({
                id: dish.id,
                name: dish.name,
                price: parseFloat(dish.price),
                emoji: dish.emoji || 'ğŸ½ï¸',
                category: dish.category || 'æœªåˆ†ç±»',
                tags: dish.tags || [],
                description: dish.description || ''
            }));
            
            return formattedDishes;
        }
        
        console.log('ğŸ“ Supabaseä¸­æ²¡æœ‰æ‰¾åˆ°èœå“');
        return null;
        
    } catch (error) {
        console.error('âŒ åŠ è½½èœå“å¼‚å¸¸:', error);
        return null;
    }
}
    
    // Supabaseé…ç½®
    const SUPABASE_URL = 'https://slonbvmhsxqgpoodwazj.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNsb25idm1oc3hxZ3Bvb2R3YXpqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwMzMyNjQsImV4cCI6MjA4NDYwOTI2NH0.YLZqdnZl1vDTOrT6bzi2ulN1BGRxKGyW30AuccuWJq4';
    
    // é¡ºåºå·ç®¡ç†
    window.sequenceNumber = '';
    window.sequencePrefix = 'A';
    window.sequenceCounter = 1;
    window.currentOrderNumber = '';
    window.lastOrderTimestamp = 0;
    
    // Supabaseå®¢æˆ·ç«¯
    window.supabaseClient = null;
    window.isCloudConnected = false;
    window.orderStatusInterval = null;
    
    // ============================================
// åˆå§‹åŒ–å‡½æ•° - å¤šå•†å®¶æ”¯æŒ
// ============================================
document.addEventListener('DOMContentLoaded', async function() {
    console.log('ğŸš€ ç³»ç»Ÿåˆå§‹åŒ–...');
    
    // 1. è·å–å½“å‰å•†å®¶é…ç½®
    window.currentShopId = getCurrentShopId();
    window.currentShopConfig = getCurrentShopConfig();
    
    console.log('ğŸª å½“å‰å•†å®¶:', window.currentShopConfig.name, 'ID:', window.currentShopId);
    
    // 2. æ›´æ–°é¡µé¢ä¸»é¢˜
    updateThemeForShop(window.currentShopConfig);
    
    // 3. åˆå§‹åŒ–Supabaseè¿æ¥
    await initSupabaseConnection();
    
    // 4. ğŸ”¥ æ–°å¢ï¼šè·å–å•†å®¶æ”¶æ¬¾ç é…ç½®ï¼ˆå¦‚æœå·²è¿æ¥äº‘ç«¯ï¼‰
    if (window.isCloudConnected) {
        await fetchShopPaymentQR();
    }
    
    // 5. ç”Ÿæˆé¡ºåºå·
    await generateSequenceNumber();
    
    // 6. åŠ¨æ€åŠ è½½èœå“ï¼ˆä¼˜å…ˆä»SupabaseåŠ è½½ï¼‰
    await loadShopDishes();
    
    // 7. åˆå§‹åŒ–èœå“åˆ†ç±»
    initCategories();
    
    // 8. åŠ è½½èœå“æ˜¾ç¤º
    loadDishes();
    
    // 9. åŠ è½½æ¨èèœå“ï¼ˆä»Supabaseï¼‰- ä¼˜å…ˆåŠ è½½
    await loadRecommendations();
    
    // 10. æ›´æ–°ç­‰å¾…ä¿¡æ¯
    updateWaitingInfo();
    
    console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
});

// ============================================
// è·å–å•†å®¶æ”¶æ¬¾ç é…ç½®ï¼ˆæ–°å¢å‡½æ•°ï¼‰
// ============================================
async function fetchShopPaymentQR() {
    try {
        if (!window.supabaseClient || !window.isCloudConnected || !window.currentShopId) {
            console.log('ğŸ“ æ— æ³•è·å–æ”¶æ¬¾ç ï¼šæœªè¿æ¥äº‘ç«¯æˆ–æ— å•†å®¶ID');
            window.shopPaymentQR = null;
            return;
        }
        
        console.log('ğŸ“± è·å–å•†å®¶æ”¶æ¬¾ç é…ç½®ï¼Œå•†å®¶ID:', window.currentShopId);
        
        // ä»Supabaseçš„shopsè¡¨è·å–å•†å®¶é…ç½®
        const { data: shopData, error } = await window.supabaseClient
            .from('shops')
            .select('wechat_qr_url, alipay_qr_url, name')
            .eq('tenant_id', window.currentShopId)
            .single();
        
        if (error) {
            console.warn('âš ï¸ è·å–å•†å®¶æ”¶æ¬¾ç å¤±è´¥:', error.message);
            console.log('é”™è¯¯è¯¦æƒ…:', error);
            window.shopPaymentQR = null;
            return;
        }
        
        if (shopData) {
            console.log('âœ… è·å–åˆ°å•†å®¶æ”¶æ¬¾ç é…ç½®:', {
                å¾®ä¿¡æ”¶æ¬¾ç : shopData.wechat_qr_url,
                æ”¯ä»˜å®æ”¶æ¬¾ç : shopData.alipay_qr_url
            });
            
            // ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­
            window.shopPaymentQR = {
                wechat: shopData.wechat_qr_url,
                alipay: shopData.alipay_qr_url,
                shopName: shopData.name
            };
        } else {
            console.log('ğŸ“ å•†å®¶æœªé…ç½®æ”¶æ¬¾ç ');
            window.shopPaymentQR = null;
        }
        
    } catch (error) {
        console.error('âŒ è·å–æ”¶æ¬¾ç é…ç½®å¼‚å¸¸:', error);
        window.shopPaymentQR = null;
    }
}
    
    // ============================================
    // åŠ¨æ€åŠ è½½å•†å®¶èœå“
    // ============================================
    async function loadShopDishes() {
        try {
            console.log('ğŸ½ï¸ å¼€å§‹åŠ è½½å•†å®¶èœå“...');
            
            // å…ˆå°è¯•ä»SupabaseåŠ è½½
            const supabaseDishes = await loadShopDishesFromSupabase(window.currentShopId);
            
            if (supabaseDishes && supabaseDishes.length > 0) {
                // ä½¿ç”¨Supabaseä¸­çš„èœå“æ•°æ®
                window._dishesData = supabaseDishes;
                console.log('âœ… ä½¿ç”¨Supabaseèœå“æ•°æ®:', supabaseDishes.length, 'ä¸ªèœå“');
            } else {
                // å¦‚æœSupabaseæ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨å•†å®¶é…ç½®ä¸­çš„èœå“
                window._dishesData = window.currentShopConfig.dishes || [];
                console.log('ğŸ“ ä½¿ç”¨å•†å®¶é…ç½®ä¸­çš„èœå“æ•°æ®:', window._dishesData.length, 'ä¸ªèœå“');
            }
            
            // å¦‚æœæ²¡æœ‰èœå“ï¼Œæ˜¾ç¤ºæç¤º
            if (window._dishesData.length === 0) {
                console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•èœå“æ•°æ®');
                showToast('å½“å‰å•†å®¶æš‚æ— èœå“', 'warning');
            }
            
        } catch (error) {
            console.error('âŒ åŠ è½½èœå“å¤±è´¥:', error);
            
            // å‡ºé”™æ—¶ä½¿ç”¨å•†å®¶é…ç½®ä¸­çš„èœå“
            window._dishesData = window.currentShopConfig.dishes || [];
            console.log('ğŸ“ å‡ºé”™æ—¶ä½¿ç”¨å•†å®¶é…ç½®ä¸­çš„èœå“æ•°æ®:', window._dishesData.length, 'ä¸ªèœå“');
        }
    }
    
    // ============================================
    // ç”Ÿæˆé¡ºåºå·ï¼ˆä»äº‘ç«¯è·å–ï¼‰- å¤šå•†å®¶æ”¯æŒ
    // ============================================
    async function generateSequenceNumber() {
    try {
        console.log('ğŸ« å¼€å§‹ç”Ÿæˆå–é¤ç ï¼Œå•†å®¶:', window.currentShopId);
        
        if (window.supabaseClient && window.isCloudConnected) {
            console.log('ğŸŒ ä»äº‘ç«¯è·å–å–é¤ç é…ç½®...');
            
            // è·å–å‰ç¼€ - æ ¹æ®å½“å‰å•†å®¶è¿‡æ»¤
            const [prefixResult, counterResult] = await Promise.all([
                window.supabaseClient
                    .from('settings')
                    .select('setting_value')
                    .eq('setting_key', 'sequence_prefix')
                    .eq('tenant_id', window.currentShopId)
                    .maybeSingle(),
                
                window.supabaseClient
                    .from('settings')
                    .select('setting_value')
                    .eq('setting_key', 'sequence_counter')
                    .eq('tenant_id', window.currentShopId)
                    .maybeSingle()
            ]);
            
            // ğŸ”¥ å¦‚æœå‰ç¼€ä¸æ˜¯A-Zï¼Œè‡ªåŠ¨ä¿®æ­£ä¸ºA
            let prefix = prefixResult.data?.setting_value || 'A';
            if (!/^[A-Z]$/.test(prefix)) {
                prefix = 'A';
                console.log('âš ï¸ å‰ç¼€æ ¼å¼ä¸æ­£ç¡®ï¼Œè‡ªåŠ¨ä¿®æ­£ä¸º A');
            }
            
            window.sequencePrefix = prefix;
            window.sequenceCounter = parseInt(counterResult.data?.setting_value) || 1;
            
            console.log('âœ… ä»äº‘ç«¯è·å–é…ç½®ï¼ˆå•†å®¶:', window.currentShopId, 'ï¼‰:', {
                prefix: window.sequencePrefix,
                counter: window.sequenceCounter
            });
            
        } else {
            console.log('ğŸ“ ä½¿ç”¨æœ¬åœ°é…ç½®ï¼ˆå•†å®¶:', window.currentShopId, 'ï¼‰');
            // ä»æœ¬åœ°å­˜å‚¨è·å–ï¼ˆæŒ‰å•†å®¶åŒºåˆ†ï¼‰
            const savedCounter = localStorage.getItem(`${window.currentShopId}_sequenceCounter`);
            const savedPrefix = localStorage.getItem(`${window.currentShopId}_sequencePrefix`) || 'A';
            
            if (savedCounter) {
                window.sequenceCounter = parseInt(savedCounter);
                window.sequencePrefix = /^[A-Z]$/.test(savedPrefix) ? savedPrefix : 'A';
            } else {
                window.sequencePrefix = 'A';
                window.sequenceCounter = 1;
            }
        }
        
        // å¦‚æœè¶…è¿‡999ï¼Œé€’å¢å‰ç¼€ï¼Œé‡ç½®è®¡æ•°å™¨
        if (window.sequenceCounter > 999) {
            const nextChar = String.fromCharCode(window.sequencePrefix.charCodeAt(0) + 1);
            window.sequencePrefix = /^[A-Z]$/.test(nextChar) ? nextChar : 'A';
            window.sequenceCounter = 1;
        }
        
        // ç”Ÿæˆé¡ºåºå·
        window.sequenceNumber = window.sequencePrefix + 
            window.sequenceCounter.toString().padStart(3, '0');
        
        console.log('ğŸ« ç”Ÿæˆçš„é¡ºåºå·ï¼ˆå•†å®¶:', window.currentShopId, 'ï¼‰:', window.sequenceNumber);
        
        // é€’å¢è®¡æ•°å™¨å¹¶ä¿å­˜
        const nextCounter = window.sequenceCounter + 1;
        
        if (window.supabaseClient && window.isCloudConnected) {
            try {
                // æ›´æ–°äº‘ç«¯è®¡æ•°å™¨ - ç¡®ä¿æŒ‰å•†å®¶æ›´æ–°
                const { error: updateError } = await window.supabaseClient
                    .from('settings')
                    .update({ 
                        setting_value: nextCounter.toString(),
                        updated_at: new Date().toISOString()
                    })
                    .eq('setting_key', 'sequence_counter')
                    .eq('tenant_id', window.currentShopId);
                
                if (updateError) {
                    console.warn('äº‘ç«¯è®¡æ•°å™¨æ›´æ–°å¤±è´¥:', updateError.message);
                    // å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem(`${window.currentShopId}_sequenceCounter`, nextCounter.toString());
                    localStorage.setItem(`${window.currentShopId}_sequencePrefix`, window.sequencePrefix);
                } else {
                    console.log('âœ… äº‘ç«¯è®¡æ•°å™¨å·²æ›´æ–°ï¼ˆå•†å®¶:', window.currentShopId, 'ï¼‰:', nextCounter);
                }
            } catch (updateError) {
                console.error('æ›´æ–°äº‘ç«¯è®¡æ•°å™¨å¼‚å¸¸:', updateError);
                // å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem(`${window.currentShopId}_sequenceCounter`, nextCounter.toString());
                localStorage.setItem(`${window.currentShopId}_sequencePrefix`, window.sequencePrefix);
            }
        } else {
            // æœ¬åœ°æ¨¡å¼
            localStorage.setItem(`${window.currentShopId}_sequenceCounter`, nextCounter.toString());
            localStorage.setItem(`${window.currentShopId}_sequencePrefix`, window.sequencePrefix);
        }
        
        window.sequenceCounter = nextCounter;
        
        // æ›´æ–°æ‰€æœ‰æ˜¾ç¤ºé¡ºåºå·çš„åœ°æ–¹
        updateSequenceNumberDisplay();
        
    } catch (error) {
        console.error('âŒ ç”Ÿæˆé¡ºåºå·å¤±è´¥:', error);
        
        // ç´§æ€¥å›é€€æ–¹æ¡ˆ
        const savedCounter = localStorage.getItem(`${window.currentShopId}_sequenceCounter`);
        const savedPrefix = localStorage.getItem(`${window.currentShopId}_sequencePrefix`) || 'A';
        
        if (savedCounter) {
            window.sequenceCounter = parseInt(savedCounter);
            window.sequencePrefix = /^[A-Z]$/.test(savedPrefix) ? savedPrefix : 'A';
        } else {
            window.sequencePrefix = 'A';
            window.sequenceCounter = 1;
        }
        
        // ç”Ÿæˆé¡ºåºå·
        window.sequenceNumber = window.sequencePrefix + 
            window.sequenceCounter.toString().padStart(3, '0');
            
        // é€’å¢è®¡æ•°å™¨
        window.sequenceCounter++;
        localStorage.setItem(`${window.currentShopId}_sequenceCounter`, window.sequenceCounter.toString());
        localStorage.setItem(`${window.currentShopId}_sequencePrefix`, window.sequencePrefix);
        
        updateSequenceNumberDisplay();
    }
}
    
    // ============================================
    // ç›‘å¬å–é¤ç é…ç½®å˜åŒ– - å¤šå•†å®¶æ”¯æŒ
    // ============================================
    function setupSequenceWatch() {
        if (!window.supabaseClient || !window.isCloudConnected) return;
        
        try {
            console.log('ğŸ“¡ å¯åŠ¨å–é¤ç é…ç½®ç›‘å¬...');
            
            window.supabaseClient
                .channel('settings-channel')
                .on('postgres_changes', 
                    { 
                        event: 'UPDATE', 
                        schema: 'public', 
                        table: 'settings',
                        filter: 'setting_key=in.(sequence_prefix,sequence_counter)'
                    }, 
                    async (payload) => {
                        // åªç›‘å¬å½“å‰å•†å®¶çš„é…ç½®å˜åŒ–
                        if (payload.new.tenant_id === window.currentShopId) {
                            console.log('ğŸ“¡ æ£€æµ‹åˆ°å–é¤ç é…ç½®æ›´æ–°:', payload.new);
                            
                            // é‡æ–°ç”Ÿæˆå–é¤ç 
                            await generateSequenceNumber();
                            
                            showToast('âœ… å–é¤ç å·²æ›´æ–°', 'success');
                        }
                    }
                )
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        console.log('âœ… å–é¤ç é…ç½®ç›‘å¬å·²å¯åŠ¨');
                    }
                });
            
        } catch (error) {
            console.error('âŒ å¯åŠ¨å–é¤ç ç›‘å¬å¤±è´¥:', error);
        }
    }
    
    // ============================================
    // Supabaseè¿æ¥åˆå§‹åŒ–ï¼ˆæ·»åŠ å–é¤ç ç›‘å¬ï¼‰
    // ============================================
    async function initSupabaseConnection() {
        try {
            if (typeof supabase === 'undefined') {
                console.error('Supabase SDK æœªåŠ è½½');
                window.isCloudConnected = false;
                return;
            }
            
            window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
            
            // æµ‹è¯•è¿æ¥ - æ³¨æ„ï¼šåŠ ä¸Štenant_idæ¡ä»¶
            const { error } = await window.supabaseClient
                .from('orders')
                .select('*')
                .eq('tenant_id', window.currentShopId) // å¤šå•†å®¶æ”¯æŒ
                .limit(1);
            
            if (error) {
                console.warn('æ•°æ®åº“è¿æ¥æµ‹è¯•å¤±è´¥:', error.message);
                window.isCloudConnected = false;
            } else {
                console.log('æ•°æ®åº“è¿æ¥æµ‹è¯•æˆåŠŸ');
                window.isCloudConnected = true;
                
                // ğŸ”¥ å¯åŠ¨å–é¤ç é…ç½®ç›‘å¬
                setupSequenceWatch();
            }
            
        } catch (error) {
            console.error('Supabaseåˆå§‹åŒ–å¤±è´¥:', error);
            window.isCloudConnected = false;
        }
    }
    
    // ============================================
    // åŠ è½½æ¨èèœå“ï¼ˆä»Supabaseï¼‰- å¤šå•†å®¶æ”¯æŒ
    // ============================================
    async function loadRecommendations() {
        try {
            console.log('ğŸ“‹ åŠ è½½æ¨èèœå“...');
            const recommendContainer = document.getElementById('recommendationsList');
            
            if (!recommendContainer) {
                console.error('âŒ æ¨èèœå“å®¹å™¨æœªæ‰¾åˆ°');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            recommendContainer.innerHTML = '<div class="loading-recommend" style="text-align: center; padding: 20px; color: #999;"><i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½æ¨èèœå“...</div>';
            
            // æ£€æŸ¥Supabaseè¿æ¥
            if (!window.supabaseClient || !window.isCloudConnected) {
                console.log('ğŸ“ Supabaseæœªè¿æ¥ï¼Œä½¿ç”¨é»˜è®¤æ¨è');
                // ä½¿ç”¨é»˜è®¤æ¨è
                updateRecommendationsDisplay([
                    { name: 'æ‹›ç‰Œèœå“', price: 15, description: 'ä»Šæ—¥ç‰¹æƒ ' },
                    { name: 'äººæ°”å¥—é¤', price: 18, description: 'äººæ°”æ¨è' }
                ]);
                return;
            }
            
            // ä»Supabaseçš„recommendationsè¡¨è·å–æ¨èèœå“ - åŠ ä¸Štenant_idæ¡ä»¶
            const { data, error } = await window.supabaseClient
                .from('recommendations')
                .select('*')
                .eq('tenant_id', window.currentShopId) // å¤šå•†å®¶æ”¯æŒï¼šåªè·å–å½“å‰å•†å®¶çš„æ¨è
                .order('sort_order', { ascending: true })
                .limit(5);
            
            if (error) {
                console.warn('âŒ è·å–æ¨èèœå“å¤±è´¥:', error.message);
                console.log('é”™è¯¯è¯¦æƒ…:', error);
                
                // ä½¿ç”¨é»˜è®¤æ¨è
                updateRecommendationsDisplay([
                    { name: 'æ‹›ç‰Œèœå“', price: 15, description: 'ä»Šæ—¥ç‰¹æƒ ' },
                    { name: 'äººæ°”å¥—é¤', price: 18, description: 'äººæ°”æ¨è' }
                ]);
                return;
            }
            
            if (data && data.length > 0) {
                console.log('âœ… åŠ è½½åˆ°æ¨èèœå“:', data.length, 'ä¸ª');
                console.log('æ¨èèœå“æ•°æ®:', data);
                
                // è½¬æ¢æ•°æ®æ ¼å¼
                const recommendations = data.map(item => ({
                    name: item.name,
                    price: item.price,
                    description: item.description || '',
                    sort_order: item.sort_order || 0
                }));
                
                updateRecommendationsDisplay(recommendations);
            } else {
                console.log('ğŸ“ æ— æ¨èèœå“ï¼Œä½¿ç”¨é»˜è®¤');
                updateRecommendationsDisplay([
                    { name: 'æ‹›ç‰Œèœå“', price: 15, description: 'ä»Šæ—¥ç‰¹æƒ ' },
                    { name: 'äººæ°”å¥—é¤', price: 18, description: 'äººæ°”æ¨è' }
                ]);
            }
            
        } catch (error) {
            console.error('âŒ åŠ è½½æ¨èèœå“å¼‚å¸¸:', error);
            
            // ä½¿ç”¨é»˜è®¤æ¨è
            updateRecommendationsDisplay([
                { name: 'æ‹›ç‰Œèœå“', price: 15, description: 'ä»Šæ—¥ç‰¹æƒ ' },
                { name: 'äººæ°”å¥—é¤', price: 18, description: 'äººæ°”æ¨è' }
            ]);
        }
    }
    
    // æ›´æ–°æ¨èæ˜¾ç¤º
    function updateRecommendationsDisplay(recommendations) {
        const recommendContainer = document.getElementById('recommendationsList');
        if (!recommendContainer) return;
        
        // æ¸…ç©ºç°æœ‰æ¨è
        recommendContainer.innerHTML = '';
        
        if (!recommendations || recommendations.length === 0) {
            recommendContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">æš‚æ— æ¨èèœå“</div>';
            return;
        }
        
        // æ·»åŠ æ¨èèœå“
        recommendations.forEach(item => {
            const recommendItem = document.createElement('div');
            recommendItem.className = 'recommend-item';
            
            // ä¸ºæ¨èèœå“æ·»åŠ ç‚¹å‡»äº‹ä»¶
            recommendItem.onclick = function() {
                // å°è¯•åœ¨èœå“åˆ—è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…çš„èœå“
                const dish = window._dishesData.find(d => {
                    // æ£€æŸ¥èœå“åç§°æ˜¯å¦åŒ…å«æ¨èåç§°ï¼ˆå¿½ç•¥ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰
                    const dishName = d.name.replace(/\s+/g, '');
                    const recommendName = item.name.replace(/\s+/g, '');
                    return dishName.includes(recommendName) || recommendName.includes(dishName);
                });
                
                if (dish) {
                    // æ‰¾åˆ°å¯¹åº”èœå“ï¼Œæ·»åŠ åˆ°è´­ç‰©è½¦
                    addRecommendation(dish.name);
                    showToast(`å·²æ·»åŠ  ${item.name}`, 'success');
                } else {
                    // æ²¡æœ‰æ‰¾åˆ°å®Œå…¨åŒ¹é…çš„èœå“ï¼Œå°è¯•æ·»åŠ åˆ°è‡ªå®šä¹‰èœå“
                    console.log('æœªæ‰¾åˆ°åŒ¹é…èœå“ï¼Œå°è¯•æ·»åŠ åˆ°è‡ªå®šä¹‰:', item.name);
                    addCustomRecommendation(item);
                }
            };
            
            // æ˜¾ç¤ºåç§°å’Œä»·æ ¼
            let displayText = item.name;
            if (item.description && item.description.trim() !== '') {
                displayText += ` (${item.description})`;
            }
            
            recommendItem.innerHTML = `
                <span>${displayText}</span>
                <span style="color: var(--primary-color); font-weight: bold;">Â¥${item.price}</span>
            `;
            
            recommendContainer.appendChild(recommendItem);
        });
    }
    
    // æ·»åŠ è‡ªå®šä¹‰æ¨èèœå“åˆ°è´­ç‰©è½¦
    function addCustomRecommendation(item) {
        // ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„èœå“IDï¼ˆä½¿ç”¨è´Ÿæ•°é¿å…ä¸ç°æœ‰èœå“å†²çªï¼‰
        const tempId = -Date.now();
        
        // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨è´­ç‰©è½¦ä¸­
        const existingItem = window._cart.find(cartItem => 
            cartItem.name === item.name && cartItem.isCustom
        );
        
        if (existingItem) {
            // å¦‚æœå·²å­˜åœ¨ï¼Œå¢åŠ æ•°é‡
            existingItem.quantity++;
        } else {
            // æ·»åŠ åˆ°è´­ç‰©è½¦
            window._cart.push({
                id: tempId,
                name: item.name,
                price: item.price,
                quantity: 1,
                isCustom: true,
                description: item.description || ''
            });
        }
        
        updateCartDisplay();
        showToast(`å·²æ·»åŠ  ${item.name}`, 'success');
    }
    
    // ============================================
// åˆ·æ–°è®¢å•çŠ¶æ€å‡½æ•° - å¤šå•†å®¶æ”¯æŒ
// ============================================
async function refreshOrderStatus() {
    try {
        const refreshBtn = document.getElementById('refreshBtn');
        const refreshIcon = document.getElementById('refreshIcon');
        const orderNumber = window.currentOrderNumber;
        
        if (!orderNumber) {
            console.log('âŒ æœªæ‰¾åˆ°å½“å‰è®¢å•å·');
            showToast('è¯·å…ˆæäº¤è®¢å•', 'error');
            return;
        }
        
        // æ˜¾ç¤ºåˆ·æ–°åŠ¨ç”»
        refreshBtn.disabled = true;
        refreshIcon.classList.add('fa-spin');
        
        console.log('ğŸ”„ åˆ·æ–°è®¢å•çŠ¶æ€:', orderNumber);
        
        if (!window.supabaseClient || !window.isCloudConnected) {
            console.log('ğŸ“ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
            // æ¨¡æ‹Ÿæ•°æ®
            const statuses = ['ç­‰å¾…æ¥å•', 'å¤„ç†ä¸­', 'å·²å®Œæˆ', 'å·²å–æ¶ˆ'];
            const randomStatus = statuses[Math.floor(Math.random() * 3)]; // ä¸åŒ…æ‹¬å·²å–æ¶ˆ
            const randomQueue = Math.floor(Math.random() * 5);
            
            document.getElementById('orderStatus').textContent = randomStatus;
            document.getElementById('queueAhead').textContent = randomQueue + 'å•';
            
            // è®¡ç®—é¢„è®¡å–é¤æ—¶é—´
            const now = new Date();
            const minutes = (randomQueue + 1) * 5; // æ¯å•5åˆ†é’Ÿ
            const pickupTime = new Date(now.getTime() + minutes * 60000);
            document.getElementById('pickupTime').textContent = 
                pickupTime.getHours().toString().padStart(2, '0') + ':' + 
                pickupTime.getMinutes().toString().padStart(2, '0');
            
            document.getElementById('lastStatusUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
            
            showToast('è®¢å•çŠ¶æ€å·²æ›´æ–°', 'success');
        } else {
            // ä»Supabaseè·å–å½“å‰è®¢å•çŠ¶æ€ - åŠ ä¸Štenant_idæ¡ä»¶
            const { data: orderData, error: orderError } = await window.supabaseClient
                .from('orders')
                .select('status, timestamp, table')
                .eq('order_number', orderNumber)
                .eq('tenant_id', window.currentShopId) // å¤šå•†å®¶æ”¯æŒ
                .single();
            
            if (orderError) {
                console.error('âŒ è·å–è®¢å•çŠ¶æ€å¤±è´¥:', orderError);
                showToast('è·å–è®¢å•çŠ¶æ€å¤±è´¥', 'error');
            } else if (orderData) {
                console.log('âœ… è·å–åˆ°è®¢å•çŠ¶æ€:', orderData);
                
                // æ›´æ–°è®¢å•çŠ¶æ€
                document.getElementById('orderStatus').textContent = orderData.status || 'ç­‰å¾…æ¥å•';
                
                // ğŸ”¥ è·å–å•†å®¶ç«¯æ‰€æœ‰æ–°è®¢å•+å¤„ç†ä¸­è®¢å•æ•°é‡ï¼ˆç´¯åŠ æ±‚å’Œï¼‰- åŠ ä¸Štenant_idæ¡ä»¶
                const { data: pendingOrders, error: pendingError } = await window.supabaseClient
                    .from('orders')
                    .select('*')
                    .eq('tenant_id', window.currentShopId) // å¤šå•†å®¶æ”¯æŒï¼šåªæŸ¥è¯¢å½“å‰å•†å®¶çš„è®¢å•
                    .in('status', ['æ–°è®¢å•', 'å¤„ç†ä¸­'])
                    .order('timestamp', { ascending: true });
                
                if (!pendingError && pendingOrders) {
                    // è®¡ç®—å‰æ–¹ç­‰å¾…è®¢å•æ•°ï¼šæ‰€æœ‰æ–°è®¢å•+å¤„ç†ä¸­è®¢å•ä¸­ï¼Œæ—¶é—´æˆ³æ—©äºå½“å‰è®¢å•çš„æ•°é‡
                    const queueCount = pendingOrders.filter(order => 
                        order.timestamp < orderData.timestamp && 
                        order.order_number !== orderNumber
                    ).length;
                    
                    console.log('ğŸ“Š å‰æ–¹ç­‰å¾…è®¢å•è®¡ç®—:', {
                        æ€»å¾…å¤„ç†è®¢å•: pendingOrders.length,
                        å½“å‰è®¢å•æ—¶é—´æˆ³: orderData.timestamp,
                        å‰æ–¹ç­‰å¾…è®¢å•æ•°: queueCount
                    });
                    
                    document.getElementById('queueAhead').textContent = queueCount + 'å•';
                    
                    // è®¡ç®—é¢„è®¡å–é¤æ—¶é—´ï¼ˆæ¯å•5åˆ†é’Ÿï¼‰
                    const now = new Date();
                    const minutes = (queueCount + 1) * 5; // å½“å‰è®¢å•ä¹Ÿè¦5åˆ†é’Ÿ
                    const pickupTime = new Date(now.getTime() + minutes * 60000);
                    document.getElementById('pickupTime').textContent = 
                        pickupTime.getHours().toString().padStart(2, '0') + ':' + 
                        pickupTime.getMinutes().toString().padStart(2, '0');
                } else {
                    // å¦‚æœæŸ¥è¯¢å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
                    document.getElementById('queueAhead').textContent = '2å•';
                    const now = new Date();
                    const pickupTime = new Date(now.getTime() + 15 * 60000);
                    document.getElementById('pickupTime').textContent = 
                        pickupTime.getHours().toString().padStart(2, '0') + ':' + 
                        pickupTime.getMinutes().toString().padStart(2, '0');
                }
                
                document.getElementById('lastStatusUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
                
                // å¦‚æœè®¢å•å·²å®Œæˆæˆ–å·²å–æ¶ˆï¼Œåœæ­¢è‡ªåŠ¨åˆ·æ–°
                if (orderData.status === 'å·²å®Œæˆ' || orderData.status === 'å·²å–æ¶ˆ') {
                    if (window.orderStatusInterval) {
                        clearInterval(window.orderStatusInterval);
                        window.orderStatusInterval = null;
                        showToast('è®¢å•å·²' + orderData.status + 'ï¼Œåœæ­¢è‡ªåŠ¨åˆ·æ–°', 'success');
                    }
                } else {
                    showToast('è®¢å•çŠ¶æ€å·²æ›´æ–°', 'success');
                }
            } else {
                showToast('æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯', 'warning');
            }
        }
        
    } catch (error) {
        console.error('âŒ åˆ·æ–°è®¢å•çŠ¶æ€å¼‚å¸¸:', error);
        showToast('åˆ·æ–°å¤±è´¥', 'error');
    } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        const refreshBtn = document.getElementById('refreshBtn');
        const refreshIcon = document.getElementById('refreshIcon');
        if (refreshBtn) refreshBtn.disabled = false;
        if (refreshIcon) refreshIcon.classList.remove('fa-spin');
    }
}
    
    // ============================================
    // åœ¨æˆåŠŸé¡µé¢å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
    // ============================================
    function startAutoRefresh() {
        // å…ˆæ‰§è¡Œä¸€æ¬¡åˆ·æ–°
        refreshOrderStatus();
        
        // è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆæ¯30ç§’ä¸€æ¬¡ï¼‰
        if (window.orderStatusInterval) {
            clearInterval(window.orderStatusInterval);
        }
        
        window.orderStatusInterval = setInterval(() => {
            refreshOrderStatus();
        }, 30000); // 30ç§’
        
        console.log('â° å¯åŠ¨è‡ªåŠ¨åˆ·æ–°ï¼Œé—´éš”30ç§’');
    }
    
    // æ›´æ–°é¡ºåºå·æ˜¾ç¤º
    function updateSequenceNumberDisplay() {
        document.getElementById('sequenceNumber').textContent = window.sequenceNumber;
        document.getElementById('currentSequence').textContent = window.sequenceNumber;
        document.getElementById('checkoutSequence').textContent = window.sequenceNumber;
        document.getElementById('successSequence').textContent = window.sequenceNumber;
    }
    
    // åˆå§‹åŒ–èœå“åˆ†ç±»
    function initCategories() {
        const categoryTabs = document.getElementById('categoryTabs');
        if (!categoryTabs) return;
        
        // è·å–æ‰€æœ‰åˆ†ç±»
        const categories = ['å…¨éƒ¨', ...new Set(window._dishesData.map(dish => dish.category))];
        
        categoryTabs.innerHTML = categories.map(category => 
            `<button class="category-tab ${category === 'å…¨éƒ¨' ? 'active' : ''}" 
                    onclick="filterDishes('${category}')">
                ${category}
            </button>`
        ).join('');
    }
    
    // è¿‡æ»¤èœå“
    function filterDishes(category) {
        // æ›´æ–°æ ‡ç­¾çŠ¶æ€
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // åŠ è½½å¯¹åº”åˆ†ç±»çš„èœå“
        loadDishes(category === 'å…¨éƒ¨' ? null : category);
    }
    
    // åŠ è½½èœå“
    function loadDishes(category = null) {
        const dishesContainer = document.getElementById('dishesContainer');
        if (!dishesContainer) return;
        
        // è¿‡æ»¤èœå“
        const filteredDishes = category 
            ? window._dishesData.filter(dish => dish.category === category)
            : window._dishesData;
        
        // ç”Ÿæˆèœå“HTML
        dishesContainer.innerHTML = filteredDishes.map(dish => {
            const cartItem = window._cart.find(item => item.id === dish.id);
            const quantity = cartItem ? cartItem.quantity : 0;
            
            return `
            <div class="dish-card">
                <div class="dish-emoji">${dish.emoji}</div>
                <div class="dish-details">
                    <div class="dish-name">${dish.name}</div>
                    <div class="dish-price">Â¥${dish.price}</div>
                    <div class="dish-actions">
                        <button class="quantity-btn" onclick="decreaseQuantity(${dish.id})" ${quantity === 0 ? 'disabled style="opacity:0.3"' : ''}>
                            <i class="fas fa-minus"></i>
                        </button>
                        <span class="dish-quantity">${quantity}</span>
                        <button class="quantity-btn" onclick="increaseQuantity(${dish.id})">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
            `;
        }).join('');
    }
    
    // å¢åŠ èœå“æ•°é‡
    function increaseQuantity(dishId) {
        const dish = window._dishesData.find(d => d.id === dishId);
        if (!dish) return;
        
        const cartItem = window._cart.find(item => item.id === dishId);
        if (cartItem) {
            cartItem.quantity++;
        } else {
            window._cart.push({
                id: dish.id,
                name: dish.name,
                price: dish.price,
                quantity: 1
            });
        }
        
        updateCartDisplay();
        loadDishes(); // åˆ·æ–°èœå“åˆ—è¡¨
    }
    
    // å‡å°‘èœå“æ•°é‡
    function decreaseQuantity(dishId) {
        const cartItem = window._cart.find(item => item.id === dishId);
        if (!cartItem) return;
        
        if (cartItem.quantity > 1) {
            cartItem.quantity--;
        } else {
            window._cart = window._cart.filter(item => item.id !== dishId);
        }
        
        updateCartDisplay();
        loadDishes(); // åˆ·æ–°èœå“åˆ—è¡¨
    }
    
    // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º
    function updateCartDisplay() {
        const totalItems = window._cart.reduce((sum, item) => sum + item.quantity, 0);
        const totalAmount = window._cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // æ›´æ–°è´­ç‰©è½¦å¾½ç« 
        document.getElementById('cartBadge').textContent = totalItems;
        
        // æ›´æ–°è´­ç‰©è½¦çŠ¶æ€
        document.getElementById('cartStatus').textContent = totalItems > 0 ? `å·²é€‰ ${totalItems} ä¸ªèœå“` : 'æœªé€‰æ‹©èœå“';
        
        // æ›´æ–°åº•éƒ¨è´­ç‰©è½¦æ 
        document.getElementById('cartItemsCount').textContent = `${totalItems}ä¸ªèœå“`;
        document.getElementById('cartTotal').textContent = totalAmount.toFixed(2);
        
        // æ›´æ–°ç»“è´¦æŒ‰é’®çŠ¶æ€
        const checkoutBtn = document.getElementById('checkoutBtn');
        const modalCheckoutBtn = document.getElementById('modalCheckoutBtn');
        if (checkoutBtn) checkoutBtn.disabled = totalItems === 0;
        if (modalCheckoutBtn) modalCheckoutBtn.disabled = totalItems === 0;
        
        // æ›´æ–°è´­ç‰©è½¦å¼¹çª—
        updateCartModal();
    }
    
    // æ›´æ–°è´­ç‰©è½¦å¼¹çª—
    function updateCartModal() {
        const cartItems = document.getElementById('cartItems');
        const modalCartTotal = document.getElementById('modalCartTotal');
        
        if (!cartItems) return;
        
        const totalAmount = window._cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        modalCartTotal.textContent = totalAmount.toFixed(2);
        
        if (window._cart.length === 0) {
            cartItems.innerHTML = '<div style="text-align:center; padding:40px; color:#999;">è´­ç‰©è½¦æ˜¯ç©ºçš„</div>';
            return;
        }
        
        cartItems.innerHTML = window._cart.map(item => `
            <div class="cart-item">
                <div class="item-info">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">Â¥${item.price} Ã— ${item.quantity}</div>
                </div>
                <div class="item-actions">
                    <button onclick="decreaseQuantity(${item.id})" style="width:28px;height:28px;border-radius:50%;border:1px solid #e0e0e0;background:white;">
                        <i class="fas fa-minus"></i>
                    </button>
                    <span style="min-width:30px;text-align:center;">${item.quantity}</span>
                    <button onclick="increaseQuantity(${item.id})" style="width:28px;height:28px;border-radius:50%;border:1px solid #e0e0e0;background:white;">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    // æ¸…ç©ºè´­ç‰©è½¦
    function clearCart() {
        if (window._cart.length === 0) return;
        if (confirm('ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ')) {
            window._cart = [];
            updateCartDisplay();
            loadDishes();
            hideCartModal();
        }
    }
    
    // æ·»åŠ æ¨èèœå“
    function addRecommendation(dishName) {
        const dish = window._dishesData.find(d => d.name === dishName);
        if (dish) {
            increaseQuantity(dish.id);
        }
    }
    
    // ============================================
    // é¡µé¢å¯¼èˆªå‡½æ•°
    // ============================================
    window.enterMenu = function() {
        // ä»é¡ºåºå·é¡µé¢åˆ‡æ¢åˆ°èœå•é¡µé¢
        switchPage('sequencePage', 'menuPage');
    };
    
    window.backToSequence = function() {
        if (window._cart.length > 0 && !confirm('è¿”å›å°†æ¸…ç©ºè´­ç‰©è½¦ï¼Œç¡®å®šè¦è¿”å›å—ï¼Ÿ')) {
            return;
        }
        window._cart = [];
        updateCartDisplay();
        loadDishes();
        switchPage('menuPage', 'sequencePage');
    };
    
    window.backToMenu = function() {
        // ä»ç»“è´¦é¡µé¢è¿”å›èœå•é¡µé¢
        switchPage('checkoutPage', 'menuPage');
    };
    
    window.showCartModal = function() {
        // æ˜¾ç¤ºè´­ç‰©è½¦å¼¹çª—
        document.getElementById('cartModal').classList.remove('hidden');
    };
    
    window.hideCartModal = function() {
        // éšè—è´­ç‰©è½¦å¼¹çª—
        document.getElementById('cartModal').classList.add('hidden');
    };
    
    // ============================================
    // æ›´æ–°äºŒç»´ç æ˜¾ç¤ºï¼ˆä¿®æ”¹åçš„å‡½æ•°ï¼‰
    // ============================================
    function updateQRCodeDisplay() {
        const qrcodeImg = document.getElementById('qrcodeImg');
        const qrcodeAmount = document.getElementById('qrcodeAmount');
        const qrcodeOverlay = document.querySelector('.qrcode-overlay');
        const qrcodeWrapper = document.getElementById('qrcodeWrapper');
        const paymentMethods = document.getElementById('paymentMethods');
        const qrErrorContainer = document.getElementById('qrErrorContainer');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        
        if (!qrcodeImg || !qrErrorContainer) return false;
        
        const totalAmount = window._cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        qrcodeAmount.textContent = totalAmount.toFixed(2);
        
        // æ¸…ç©ºé”™è¯¯å®¹å™¨
        qrErrorContainer.innerHTML = '';
        qrErrorContainer.style.display = 'none';
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å•†å®¶æ”¶æ¬¾ç é…ç½®
        if (window.shopPaymentQR) {
            const { wechat, alipay, shopName } = window.shopPaymentQR;
            
            // ğŸ”¥ æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ”¶æ¬¾ç 
            const hasWechatQR = wechat && wechat.trim() !== '';
            const hasAlipayQR = alipay && alipay.trim() !== '';
            
            if (!hasWechatQR && !hasAlipayQR) {
                // ä¸¤ç§æ”¶æ¬¾ç éƒ½æ²¡æœ‰ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                showQRCodeError("å•†å®¶å°šæœªé…ç½®æ”¶æ¬¾ç ", "è¯·è”ç³»å•†å®¶ä¸Šä¼ å¾®ä¿¡æˆ–æ”¯ä»˜å®æ”¶æ¬¾ç åå†ä¸‹å•");
                submitOrderBtn.disabled = true;
                return false;
            }
            
            // éšè—äºŒç»´ç å®¹å™¨ï¼Œç­‰å¾…è®¾ç½®
            qrcodeImg.style.display = 'none';
            qrcodeOverlay.style.display = 'none';
            
            // å¦‚æœæœ‰ä¸¤ç§æ”¶æ¬¾ç ï¼Œæ˜¾ç¤ºæ”¯ä»˜æ–¹å¼é€‰æ‹©
            if (hasWechatQR && hasAlipayQR) {
                paymentMethods.style.display = 'flex';
                
                // è®¾ç½®é»˜è®¤æ”¯ä»˜æ–¹å¼ï¼ˆå¾®ä¿¡ï¼‰
                currentPaymentMethod = 'wechat';
                qrcodeImg.src = wechat;
                qrcodeImg.style.display = 'block';
                qrcodeOverlay.style.display = 'block';
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.getElementById('paymentMethodWechat').classList.add('active');
                document.getElementById('paymentMethodAlipay').classList.remove('active');
                
                console.log('âœ… å·²è®¾ç½®å¾®ä¿¡æ”¶æ¬¾ç :', wechat);
                submitOrderBtn.disabled = false;
                return true;
            } 
            // å¦‚æœåªæœ‰å¾®ä¿¡æ”¶æ¬¾ç 
            else if (hasWechatQR) {
                paymentMethods.style.display = 'none';
                qrcodeImg.src = wechat;
                qrcodeImg.style.display = 'block';
                qrcodeOverlay.style.display = 'block';
                console.log('âœ… å·²è®¾ç½®å¾®ä¿¡æ”¶æ¬¾ç ï¼ˆå•ä¸€ï¼‰:', wechat);
                submitOrderBtn.disabled = false;
                return true;
            }
            // å¦‚æœåªæœ‰æ”¯ä»˜å®æ”¶æ¬¾ç 
            else if (hasAlipayQR) {
                paymentMethods.style.display = 'none';
                qrcodeImg.src = alipay;
                qrcodeImg.style.display = 'block';
                qrcodeOverlay.style.display = 'block';
                console.log('âœ… å·²è®¾ç½®æ”¯ä»˜å®æ”¶æ¬¾ç ï¼ˆå•ä¸€ï¼‰:', alipay);
                submitOrderBtn.disabled = false;
                return true;
            }
        } else {
            // æ²¡æœ‰å•†å®¶é…ç½®ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            showQRCodeError("æ— æ³•è·å–å•†å®¶æ”¶æ¬¾ç ", "å•†å®¶æ”¶æ¬¾ç é…ç½®ä¿¡æ¯æœªæ‰¾åˆ°ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»å•†å®¶");
            submitOrderBtn.disabled = true;
            return false;
        }
    }
    
    // ============================================
    // æ˜¾ç¤ºæ”¶æ¬¾ç é”™è¯¯ä¿¡æ¯ï¼ˆæ–°å¢å‡½æ•°ï¼‰
    // ============================================
    function showQRCodeError(title, message) {
        const qrErrorContainer = document.getElementById('qrErrorContainer');
        const qrcodeImg = document.getElementById('qrcodeImg');
        const qrcodeOverlay = document.querySelector('.qrcode-overlay');
        const paymentMethods = document.getElementById('paymentMethods');
        
        // éšè—æ”¯ä»˜ç›¸å…³å…ƒç´ 
        if (qrcodeImg) qrcodeImg.style.display = 'none';
        if (qrcodeOverlay) qrcodeOverlay.style.display = 'none';
        if (paymentMethods) paymentMethods.style.display = 'none';
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        qrErrorContainer.innerHTML = `
            <div class="qr-error-message">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>${title}</h4>
                <p>${message}</p>
                <p style="font-size: 12px; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> è¯·å‘ŠçŸ¥å•†å®¶ï¼šç™»å½•å•†å®¶åå°ï¼Œåœ¨"æ”¶æ¬¾è®¾ç½®"ä¸­ä¸Šä¼ æ”¶æ¬¾ç 
                </p>
            </div>
        `;
        qrErrorContainer.style.display = 'block';
        
        console.warn('âš ï¸ æ”¶æ¬¾ç é”™è¯¯:', title, '-', message);
    }
    
    // ============================================
    // æ”¯ä»˜æ–¹å¼åˆ‡æ¢ï¼ˆæ–°å¢å‡½æ•°ï¼‰
    // ============================================
    window.switchPaymentMethod = function(method) {
        console.log('ğŸ”„ åˆ‡æ¢æ”¯ä»˜æ–¹å¼:', method);
        
        const wechatBtn = document.getElementById('paymentMethodWechat');
        const alipayBtn = document.getElementById('paymentMethodAlipay');
        const qrcodeImg = document.getElementById('qrcodeImg');
        
        if (!window.shopPaymentQR) {
            console.warn('âš ï¸ æœªè·å–åˆ°å•†å®¶æ”¶æ¬¾ç é…ç½®');
            return;
        }
        
        currentPaymentMethod = method;
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        if (method === 'wechat') {
            wechatBtn.classList.add('active');
            alipayBtn.classList.remove('active');
            
            // åˆ‡æ¢åˆ°å¾®ä¿¡æ”¶æ¬¾ç 
            if (window.shopPaymentQR.wechat && window.shopPaymentQR.wechat.trim() !== '') {
                qrcodeImg.src = window.shopPaymentQR.wechat;
                console.log('âœ… å·²åˆ‡æ¢åˆ°å¾®ä¿¡æ”¶æ¬¾ç ');
            } else {
                console.warn('âš ï¸ å•†å®¶æœªé…ç½®å¾®ä¿¡æ”¶æ¬¾ç ');
                showQRCodeError("å¾®ä¿¡æ”¶æ¬¾ç æœªé…ç½®", "å•†å®¶å°šæœªä¸Šä¼ å¾®ä¿¡æ”¶æ¬¾ç ï¼Œè¯·é€‰æ‹©å…¶ä»–æ”¯ä»˜æ–¹å¼æˆ–è”ç³»å•†å®¶");
            }
        } else if (method === 'alipay') {
            wechatBtn.classList.remove('active');
            alipayBtn.classList.add('active');
            
            // åˆ‡æ¢åˆ°æ”¯ä»˜å®æ”¶æ¬¾ç 
            if (window.shopPaymentQR.alipay && window.shopPaymentQR.alipay.trim() !== '') {
                qrcodeImg.src = window.shopPaymentQR.alipay;
                console.log('âœ… å·²åˆ‡æ¢åˆ°æ”¯ä»˜å®æ”¶æ¬¾ç ');
            } else {
                console.warn('âš ï¸ å•†å®¶æœªé…ç½®æ”¯ä»˜å®æ”¶æ¬¾ç ');
                showQRCodeError("æ”¯ä»˜å®æ”¶æ¬¾ç æœªé…ç½®", "å•†å®¶å°šæœªä¸Šä¼ æ”¯ä»˜å®æ”¶æ¬¾ç ï¼Œè¯·é€‰æ‹©å…¶ä»–æ”¯ä»˜æ–¹å¼æˆ–è”ç³»å•†å®¶");
            }
        }
    }
    
    // ============================================
// é¡µé¢å¯¼èˆªå‡½æ•°
// ============================================
window.goToCheckout = function() {
    if (window._cart.length === 0) {
        alert('è¯·å…ˆé€‰æ‹©èœå“');
        return;
    }
    
    // ğŸ”¥ æ£€æŸ¥æ˜¯å¦æœ‰å•†å®¶æ”¶æ¬¾ç é…ç½®
    if (window.shopPaymentQR) {
        const { wechat, alipay } = window.shopPaymentQR;
        const hasWechatQR = wechat && wechat.trim() !== '';
        const hasAlipayQR = alipay && alipay.trim() !== '';
        
        if (!hasWechatQR && !hasAlipayQR) {
            alert('å•†å®¶å°šæœªé…ç½®æ”¶æ¬¾ç ï¼Œæ— æ³•å®Œæˆæ”¯ä»˜ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»å•†å®¶ã€‚');
            return;
        }
    } else if (window.isCloudConnected) {
        // å°è¯•é‡æ–°è·å–æ”¶æ¬¾ç é…ç½®
        fetchShopPaymentQR().then(() => {
            if (window.shopPaymentQR) {
                const { wechat, alipay } = window.shopPaymentQR;
                const hasWechatQR = wechat && wechat.trim() !== '';
                const hasAlipayQR = alipay && alipay.trim() !== '';
                
                if (!hasWechatQR && !hasAlipayQR) {
                    alert('å•†å®¶å°šæœªé…ç½®æ”¶æ¬¾ç ï¼Œæ— æ³•å®Œæˆæ”¯ä»˜ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»å•†å®¶ã€‚');
                    return;
                }
            } else {
                alert('å•†å®¶å°šæœªé…ç½®æ”¶æ¬¾ç ï¼Œæ— æ³•å®Œæˆæ”¯ä»˜ï¼Œè¯·ç¨åå†è¯•æˆ–è”ç³»å•†å®¶ã€‚');
                return;
            }
            
            // ç»§ç»­æ‰§è¡Œç»“è´¦æµç¨‹
            proceedToCheckout();
        });
        return;
    }
    
    // ç”Ÿæˆè®¢å•å·
    const now = new Date();
    const year = now.getFullYear().toString().slice(-2);
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hour = String(now.getHours()).padStart(2, '0');
    const minute = String(now.getMinutes()).padStart(2, '0');
    const second = String(now.getSeconds()).padStart(2, '0');
    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
    window.currentOrderNumber = year + month + day + hour + minute + second + random;
    
    // æ›´æ–°ç»“è´¦é¡µé¢ä¿¡æ¯
    document.getElementById('orderNumber').textContent = window.currentOrderNumber;
    document.getElementById('orderTime').textContent = now.toLocaleString('zh-CN');
    
    // æ›´æ–°è®¢å•èœå“åˆ—è¡¨
    const checkoutItems = document.getElementById('checkoutItems');
    checkoutItems.innerHTML = window._cart.map(item => `
        <div class="order-item">
            <span>${item.name} Ã— ${item.quantity}</span>
            <span>Â¥${(item.price * item.quantity).toFixed(2)}</span>
        </div>
    `).join('');
    
    // æ›´æ–°æ€»é‡‘é¢
    const totalAmount = window._cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    document.getElementById('finalAmount').textContent = totalAmount.toFixed(2);
    document.getElementById('qrcodeAmount').textContent = totalAmount.toFixed(2);
    
    // ğŸ”¥ æ›´æ–°äºŒç»´ç æ˜¾ç¤ºï¼ˆæ£€æŸ¥æ”¶æ¬¾ç ï¼‰
    updateQRCodeDisplay();
    
    // éšè—è´­ç‰©è½¦å¼¹çª—
    hideCartModal();
    
    // åˆ‡æ¢åˆ°ç»“è´¦é¡µé¢
    switchPage('menuPage', 'checkoutPage');
};
    
    // ============================================
// æäº¤è®¢å•å‡½æ•°ï¼ˆå¤šå•†å®¶æ”¯æŒï¼‰
// ============================================
window.submitOrder = async function() {
    console.log('ğŸ“¤ æäº¤è®¢å•...');
    
    if (window._cart.length === 0) {
        alert('è®¢å•ä¸­æ²¡æœ‰èœå“');
        return;
    }
    
    // ğŸ”¥ å†æ¬¡æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ”¶æ¬¾ç ï¼ˆä½†åªæ£€æŸ¥ï¼Œä¸é˜»æ­¢æäº¤ï¼‰
    if (window.shopPaymentQR) {
        const { wechat, alipay } = window.shopPaymentQR;
        const hasWechatQR = wechat && wechat.trim() !== '';
        const hasAlipayQR = alipay && alipay.trim() !== '';
        
        if (!hasWechatQR && !hasAlipayQR) {
            if (!confirm('å•†å®¶å°šæœªé…ç½®æ”¶æ¬¾ç ï¼Œè®¢å•æäº¤åé¡¾å®¢æ— æ³•æ”¯ä»˜ã€‚ç¡®å®šè¦ç»§ç»­æäº¤å—ï¼Ÿ')) {
                return;
            }
        }
    }
    
    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
    document.getElementById('loadingOverlay').classList.remove('hidden');
    
    const totalAmount = window._cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const orderTime = new Date().toLocaleString('zh-CN');
    const dishesString = window._cart.map(item => 
        `${item.name} Ã— ${item.quantity} = Â¥${(item.price * item.quantity).toFixed(2)}`
    ).join('; ');
    
    // æ„å»ºè®¢å•æ•°æ® - æ·»åŠ tenant_idå­—æ®µ
    const orderData = {
        table: window.sequenceNumber,
        dishes: dishesString,
        status: 'æ–°è®¢å•',
        timestamp: Date.now(),
        order_number: window.currentOrderNumber,
        total_amount: parseFloat(totalAmount.toFixed(2)),
        order_time: orderTime,
        tenant_id: window.currentShopId  // ğŸ”¥ å¤šå•†å®¶æ”¯æŒï¼šæ·»åŠ å•†å®¶ID
    };
    
    console.log('è®¢å•æ•°æ®:', orderData);
    
    // ä¿å­˜è®¢å•å·å’Œæ—¶é—´æˆ³
    window.lastOrderTimestamp = orderData.timestamp;
    
    // å°è¯•æäº¤åˆ°äº‘ç«¯
    if (window.isCloudConnected && window.supabaseClient) {
        try {
            const { data, error } = await window.supabaseClient
                .from('orders')
                .insert([orderData])
                .select();
            
            if (error) {
                console.error('æäº¤åˆ°Supabaseå¤±è´¥:', error);
                saveOrderLocally(orderData);
            } else {
                console.log('è®¢å•æäº¤æˆåŠŸ:', data[0]);
                showSuccessPage();
            }
        } catch (error) {
            console.error('æäº¤å¼‚å¸¸:', error);
            saveOrderLocally(orderData);
        }
    } else {
        // ç¦»çº¿æ¨¡å¼ï¼Œä¿å­˜åˆ°æœ¬åœ°
        saveOrderLocally(orderData);
    }
    
    // æ¸…ç©ºè´­ç‰©è½¦
    window._cart = [];
    updateCartDisplay();
    
    // éšè—åŠ è½½åŠ¨ç”»
    document.getElementById('loadingOverlay').classList.add('hidden');
};
    
    // ä¿å­˜è®¢å•åˆ°æœ¬åœ°
    function saveOrderLocally(orderData) {
        try {
            const localOrders = JSON.parse(localStorage.getItem('localOrders') || '[]');
            localOrders.push({
                ...orderData,
                is_local: true,
                saved_at: new Date().toISOString()
            });
            localStorage.setItem('localOrders', JSON.stringify(localOrders));
            console.log('è®¢å•å·²ä¿å­˜åˆ°æœ¬åœ°');
        } catch (error) {
            console.error('ä¿å­˜åˆ°æœ¬åœ°å¤±è´¥:', error);
        }
        
        showSuccessPage();
    }
    
    // ============================================
    // æ˜¾ç¤ºæˆåŠŸé¡µé¢ï¼ˆä¿®æ”¹ï¼‰
    // ============================================
    function showSuccessPage() {
        // è®¾ç½®åˆå§‹é¢„è®¡å–é¤æ—¶é—´ï¼ˆå½“å‰æ—¶é—´+10åˆ†é’Ÿï¼‰
        const now = new Date();
        const pickupTime = new Date(now.getTime() + 10 * 60000);
        document.getElementById('pickupTime').textContent = 
            pickupTime.getHours().toString().padStart(2, '0') + ':' + 
            pickupTime.getMinutes().toString().padStart(2, '0');
        
        // è®¾ç½®åˆå§‹çŠ¶æ€
        document.getElementById('orderStatus').textContent = 'ç­‰å¾…æ¥å•';
        document.getElementById('queueAhead').textContent = '2å•';
        document.getElementById('lastStatusUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
        
        // åˆ‡æ¢åˆ°æˆåŠŸé¡µé¢
        switchPage('checkoutPage', 'successPage');
        
        // å¯åŠ¨è‡ªåŠ¨åˆ·æ–°
        setTimeout(() => {
            startAutoRefresh();
        }, 1000);
    }
    
    // ============================================
    // æ–°å¢è®¢å•æ—¶é‡ç½®
    // ============================================
    window.newOrder = function() {
        // åœæ­¢è‡ªåŠ¨åˆ·æ–°
        if (window.orderStatusInterval) {
            clearInterval(window.orderStatusInterval);
            window.orderStatusInterval = null;
        }
        
        // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„è®¢å•æ•°æ®ï¼ˆé¿å…æ··æ·†ï¼‰
        localStorage.removeItem('last_order_number');
        localStorage.removeItem('last_order_data');
        
        // ç”Ÿæˆæ–°çš„é¡ºåºå·
        generateSequenceNumber();
        
        // æ¸…ç©ºè´­ç‰©è½¦
        window._cart = [];
        updateCartDisplay();
        
        // é‡æ–°åŠ è½½æ¨èèœå“ï¼ˆç¡®ä¿è·å–æœ€æ–°çš„ï¼‰
        setTimeout(async () => {
            await loadRecommendations();
        }, 500);
        
        // åˆ‡æ¢åˆ°é¡ºåºå·é¡µé¢
        switchPage('successPage', 'sequencePage');
    };
    
    // ============================================
    // å·¥å…·å‡½æ•°
    // ============================================
    function switchPage(fromPage, toPage) {
        document.getElementById(fromPage).classList.add('hidden');
        document.getElementById(toPage).classList.remove('hidden');
    }
    
    // æ¨¡æ‹Ÿç­‰å¾…ä¿¡æ¯æ›´æ–°
    function updateWaitingInfo() {
        const waitingOrders = Math.floor(Math.random() * 5) + 1;
        const waitingMinutes = waitingOrders * 3 + Math.floor(Math.random() * 5);
        
        document.getElementById('waitingCount').textContent = `çº¦${waitingOrders}å•`;
        document.getElementById('waitingTime').textContent = `${waitingMinutes}åˆ†é’Ÿ`;
        if (document.getElementById('queueAhead')) {
            document.getElementById('queueAhead').textContent = `${waitingOrders}å•`;
        }
    }
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message, type = 'success') {
        // ç§»é™¤å·²æœ‰çš„toast
        document.querySelectorAll('.toast-message').forEach(toast => toast.remove());
        
        const toast = document.createElement('div');
        toast.className = 'toast-message';
        toast.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: ${type === 'success' ? '#4CAF50' : type === 'warning' ? '#ff9800' : '#f44336'};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            max-width: 300px;
            animation: slideIn 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        `;
        
        const icon = type === 'success' ? 'fa-check-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-times-circle';
        toast.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100%)';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
    
    // ============================================
    // æ›´æ–°ä¸»é¢˜å‡½æ•°ï¼ˆå¤šå•†å®¶æ”¯æŒï¼‰
    // ============================================
    function updateThemeForShop(shopConfig) {
        if (!shopConfig) return;
        
        // æ›´æ–°CSSå˜é‡
        if (shopConfig.themeColor) {
            document.documentElement.style.setProperty('--primary-color', shopConfig.themeColor);
        }
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜
        document.title = `${shopConfig.name} - æ‰«ç ç‚¹é¤`;
        
        // æ›´æ–°Logoï¼ˆå¦‚æœå•†å®¶æœ‰å•ç‹¬çš„Logoï¼‰
        if (shopConfig.logo) {
            const logoImg = document.querySelector('.logo-image');
            if (logoImg) {
                logoImg.src = shopConfig.logo;
                logoImg.alt = shopConfig.name;
            }
        }
        
        // æ›´æ–°åº—é“ºåç§°æ˜¾ç¤º
        const welcomeTitle = document.querySelector('.logo-container h1');
        if (welcomeTitle) {
            welcomeTitle.textContent = `æ¬¢è¿å…‰ä¸´ ${shopConfig.name}`;
        }
    }
    
    // ============================================
    // è·å–å½“å‰å•†å®¶IDï¼ˆæ–°å¢å‡½æ•°ï¼‰
    // ============================================
    function getCurrentShopId() {
        // ä»URLå‚æ•°è·å–å•†å®¶ID
        const urlParams = new URLSearchParams(window.location.search);
        const shopId = urlParams.get('shop');
        
        if (shopId) {
            return shopId;
        }
        
        // ä»localStorageè·å–é»˜è®¤å•†å®¶
        const registeredShops = JSON.parse(localStorage.getItem('registered_shops') || '{}');
        const shopIds = Object.keys(registeredShops);
        
        if (shopIds.length > 0) {
            return shopIds[0];
        }
        
        // å¦‚æœæ²¡æœ‰å•†å®¶IDï¼Œä½¿ç”¨é»˜è®¤
        console.warn('âš ï¸ æœªæ‰¾åˆ°å•†å®¶IDï¼Œä½¿ç”¨é»˜è®¤');
        return 'default';
    }
    
    // ============================================
    // è·å–å½“å‰å•†å®¶é…ç½®ï¼ˆæ–°å¢å‡½æ•°ï¼‰
    // ============================================
    function getCurrentShopConfig() {
        const shopId = window.currentShopId || getCurrentShopId();
        
        // ä»localStorageè·å–å•†å®¶é…ç½®
        const shopConfigStr = localStorage.getItem('shop_config_' + shopId);
        if (shopConfigStr) {
            try {
                const config = JSON.parse(shopConfigStr);
                if (config[shopId]) {
                    console.log('âœ… ä»localStorageåŠ è½½å•†å®¶é…ç½®:', config[shopId].name);
                    return config[shopId];
                }
            } catch (error) {
                console.error('âŒ è§£æå•†å®¶é…ç½®å¤±è´¥:', error);
            }
        }
        
        // å¦‚æœlocalStorageæ²¡æœ‰ï¼Œå°è¯•ä»å…¨å±€é…ç½®è·å–
        if (window.shopConfigs && window.shopConfigs[shopId]) {
            console.log('âœ… ä»å…¨å±€é…ç½®åŠ è½½å•†å®¶é…ç½®:', window.shopConfigs[shopId].name);
            return window.shopConfigs[shopId];
        }
        
        // ä½¿ç”¨é»˜è®¤é…ç½®
        console.log('ğŸ“ ä½¿ç”¨é»˜è®¤å•†å®¶é…ç½®');
        return {
            name: 'æˆ‘çš„æ‘Šä½',
            themeColor: '#E63946',
            logo: 'images/logo.png',
            qrcode: 'images/qrcode.jpg',
            dishes: [
                { id: 1, name: 'æ‹›ç‰Œç‚¸é…±é¢', price: 15, category: 'ä¸»é£Ÿ', emoji: 'ğŸœ' },
                { id: 2, name: 'éº»è¾£çƒ«å¥—é¤', price: 18, category: 'ä¸»é£Ÿ', emoji: 'ğŸ¥˜' },
                { id: 3, name: 'é¦™é…¥é¸¡æ’', price: 12, category: 'å°åƒ', emoji: 'ğŸ—' },
                { id: 4, name: 'å†°é•‡é…¸æ¢…æ±¤', price: 5, category: 'é¥®æ–™', emoji: 'ğŸ¥¤' }
            ]
        };
    }
    </script>
</body>
</html>
